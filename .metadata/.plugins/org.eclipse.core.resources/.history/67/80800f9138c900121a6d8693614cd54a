/*
 * Comport1.cpp
 *
 *  Created on: 30.05.2013
 *      Author: maschood
 */

#include "Comport1.h"

Comport1::Comport1() {
	fd = open("/dev/ser1", O_RDWR); // O_NOBLOCK => nicht blockierend
	if (fd < 0) {
		perror("/dev/ser1");
		exit(-1);
	}
}

Comport1::~Comport1() {
	close(fd);
}

void Comport1::execute(void* arg) {
	int buffer [1000];
		void* buf = NULL;
		buf = buffer;


	while (1) {
		readcond(fd, buf, 16, 16, // kein min/max
				1, // max. 0.1 Sekunden zwischen 2 zusammengehörigen Bytes
				0 // ohne Timeout blockieren, bis etwas gesendet wurde
		);

		for (int i = 0; i < 5; i++) {
			cout << buffer[i] << endl;

		}

	}

}

void Comport1::shutdown() {

}

